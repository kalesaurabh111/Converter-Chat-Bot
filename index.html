<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Converter + Quants Bot</title>
<style>
  /* App frame */
  html, body { height: 100%; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background: #eef2ff;
    display: flex;
    justify-content: center;   /* center horizontally */
    align-items: center;       /* center vertically */
  }
  /* Card */
  .chat {
    width: min(720px, 96vw);
    height: min(84vh, 820px);  /* defined height prevents centering issues */
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 16px;
    box-shadow: 0 12px 32px rgba(0,0,0,.08);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  /* Header */
  .head {
    background: #2563eb;
    color: #fff;
    padding: 12px 14px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .dot { width: 10px; height: 10px; border-radius: 50%; background: #22c55e; box-shadow: 0 0 0 6px rgba(34,197,94,.25); }
  .head h1 { margin: 0; font-size: 16px; }
  /* Messages */
  .msgs { flex: 1; overflow: auto; background: #f8fafc; padding: 14px; }
  .row { display: flex; margin: 8px 0; }
  .row.user { justify-content: flex-end; }
  .bubble {
    max-width: 80%;
    padding: 10px 12px;
    border-radius: 14px;
    line-height: 1.4;
    font-size: 14px;
    word-break: break-word;
  }
  .row.user .bubble { background: #2563eb; color: #fff; border-bottom-right-radius: 6px; }
  .row.bot  .bubble { background: #fff; color: #0f172a; border: 1px solid #e5e7eb; border-bottom-left-radius: 6px; }
  .suggest { display: flex; flex-wrap: wrap; gap: 8px; margin: 6px 0 10px; }
  .chip { font-size: 12px; padding: 6px 10px; border-radius: 999px; border: 1px solid #e5e7eb; background: #fff; cursor: pointer; }
  .chip:hover { background: #2563eb; color: #fff; border-color: #2563eb; }
  .typing { display: none; margin: 8px 0; }
  .dots { display: flex; gap: 5px; }
  .dots span { width: 8px; height: 8px; border-radius: 50%; background: #94a3b8; animation: blink 1.2s infinite; }
  .dots span:nth-child(2){ animation-delay:.2s } .dots span:nth-child(3){ animation-delay:.4s }
  @keyframes blink { 0%,60%,100%{opacity:.25} 30%{opacity:1} }
  /* Input */
  .input { display: flex; gap: 8px; border-top: 1px solid #e5e7eb; padding: 10px; background: #fff; }
  .input input { flex: 1; border: 1px solid #d1d5db; border-radius: 999px; padding: 10px 12px; font-size: 14px; outline: none; }
  .input input:focus { border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,.15); }
  .input button { width: 44px; height: 44px; border-radius: 50%; border: none; background: #2563eb; color: #fff; font-size: 18px; cursor: pointer; }
  .input button:hover { background: #1e40af; }
  /* Results */
  .result { background: #ecfdf5; border: 1px solid #34d399; border-radius: 10px; padding: 10px; margin-top: 8px; }
  .steps { font-size: 13px; color: #334155; margin-top: 8px; }
</style>
</head>
<body>
  <div class="chat" id="app">
    <div class="head"><div class="dot"></div><h1>AI Converter + Quants Bot</h1></div>
    <div class="msgs" id="msgs">
      <div class="row bot"><div class="bubble">
        Welcome! Ask conversions or quants like:
        <div class="suggest">
          <button class="chip" onclick="quick('5 ft to m')">5 ft to m</button>
          <button class="chip" onclick="quick('120 km at 60 km/h time?')">STD time</button>
          <button class="chip" onclick="quick('train 100 m and 200 m at 20 m/s opposite direction crossing time?')">Trains</button>
          <button class="chip" onclick="quick('boat 20 km downstream in 40 min stream 2.5 km/h return time?')">Boat</button>
          <button class="chip" onclick="quick('pipe A fills 6 h, B fills 10 h, together?')">Pipes</button>
        </div>
      </div></div>
      <div class="typing" id="typing"><div class="dots"><span></span><span></span><span></span></div></div>
    </div>
    <div class="input">
      <input id="inp" placeholder="Type and press Enter…" />
      <button id="send">➤</button>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const msgs = document.getElementById('msgs');
  const typing = document.getElementById('typing');
  const inp = document.getElementById('inp');
  const sendBtn = document.getElementById('send');

  function add(who, html){
    const row = document.createElement('div'); row.className = 'row ' + who;
    const b = document.createElement('div'); b.className = 'bubble'; b.innerHTML = html;
    row.appendChild(b); msgs.appendChild(row); msgs.scrollTop = msgs.scrollHeight;
  }
  function showTyping(s){ typing.style.display = s? 'block':'none'; msgs.scrollTop = msgs.scrollHeight; }
  function round(x,p=5){ const f=10**p; return Math.round(x*f)/f; }

  const conv = {
    length:{m:1, meter:1, meters:1, ft:0.3048, foot:0.3048, feet:0.3048, in:0.0254, inch:0.0254, inches:0.0254, km:1000, kilometer:1000, kilometers:1000, mi:1609.34, mile:1609.34, miles:1609.34},
    weight:{kg:1, kilogram:1, g:0.001, gram:0.001, lb:0.453592, pound:0.453592, oz:0.0283495, ounce:0.0283495},
    volume:{l:1, liter:1, ml:0.001, milliliter:0.001, gal:3.78541, gallon:3.78541},
    time:{s:1, sec:1, second:1, min:60, minute:60, h:3600, hr:3600, hour:3600},
    temp:{c:'c', celsius:'c', f:'f', fahrenheit:'f', k:'k', kelvin:'k'}
  };
  function norm(u){ return u.toLowerCase().replace(/[^\w]/g,'').trim(); }
  function findCat(u){
    const n = norm(u);
    for(const [cat, map] of Object.entries(conv)){ if(n in map) return {cat, key:n}; }
    return null;
  }
  function tconvert(v,f,t){ let C; if(f==='c') C=v; else if(f==='f') C=(v-32)*5/9; else C=v-273.15; if(t==='c')return C; if(t==='f')return C*9/5+32; if(t==='k')return C+273.15; }
  function convert(v, from, to){
    const F=findCat(from), T=findCat(to); if(!F||!T) return {ok:false, msg:'Unknown unit'};
    if(F.cat!==T.cat) return {ok:false, msg:'Different categories'};
    if(F.cat==='temp') return {ok:true, val:tconvert(v, conv.temp[F.key], conv.temp[T.key])};
    return {ok:true, val: v * conv[F.cat][F.key] / conv[T.cat][T.key]};
  }
  function parseConv(s){
    const p=/(\d+(?:\.\d+)?)\s*([a-zA-Z°/ ]+?)\s*(?:to|into|in|→)\s*([a-zA-Z°/ ]+)/i;
    const m=s.match(p); if(!m) return null; return {v:parseFloat(m[13]), from:m[14].trim(), to:m[15].trim()};
  }

  function solveSTD(q){
    q=q.toLowerCase();
    const d=q.match(/(\d+(?:\.\d+)?)\s*(km|kilometer|kilometers|m|meter|meters|mile|miles)\b/);
    const t=q.match(/(\d+(?:\.\d+)?)\s*(h|hr|hour|hours|min|minute|minutes|s|sec|second|seconds)\b/);
    const s=q.match(/(\d+(?:\.\d+)?)\s*(km\/h|kmh|kph|m\/s|mps|mph)\b/);
    function toKm(x,u){ if(!x) return null; if(u.startsWith('km')) return x; if(u==='mile'||u==='miles') return x*1.60934; if(u==='m'||u==='meter'||u==='meters') return x/1000; return x; }
    function toH(x,u){ if(!x) return null; if(['h','hr','hour','hours'].includes(u)) return x; if(u.startsWith('min')) return x/60; if(['s','sec','second','seconds'].includes(u)) return x/3600; return x; }
    function toKmh(x,u){ if(!x) return null; if(['km/h','kmh','kph'].includes(u)) return x; if(['m/s','mps'].includes(u)) return x*3.6; if(u==='mph') return x*1.60934; return x; }
    const D=d?toKm(parseFloat(d[13]), d[14]):null, T=t?toH(parseFloat(t[13]), t[14]):null, S=s?toKmh(parseFloat(s[13]), s[14]):null;
    const wantTime=/\btime\b|\btime\?\b|\bhow long\b/.test(q), wantSpeed=/\bspeed\b|\bvelocity\b/.test(q), wantDist=/\bdistance\b/.test(q);
    if(S!=null&&T!=null&&(wantDist||(!wantSpeed&&!wantTime))) return {type:'dist', val:S*T, unit:'km', steps:`D = S × T`};
    if(D!=null&&T!=null&&(wantSpeed||(!wantDist&&!wantTime))) return {type:'speed', val:D/T, unit:'km/h', steps:`S = D ÷ T`};
    if(D!=null&&S!=null&&(wantTime||(!wantDist&&!wantSpeed))) return {type:'time', val:D/S, unit:'h', steps:`T = D ÷ S`};
    return null;
  }
  function solveTrains(q){
    q=q.toLowerCase();
    const L=[...q.matchAll(/(\d+(?:\.\d+)?)\s*(m|meter|meters)\b/g)].map(m=>parseFloat(m[13]));
    const V=[...q.matchAll(/(\d+(?:\.\d+)?)\s*(m\/s|mps|km\/h|kmh|kph)\b/g)].map(m=>{let v=parseFloat(m[13]); if(['km/h','kmh','kph'].includes(m[14])) v=v*1000/3600; return v;});
    const opposite=/\bopposite\b|\btowards\b/.test(q), same=/\bsame direction\b/.test(q);
    const bridge=q.match(/bridge\s*(\d+(?:\.\d+)?)\s*(m|meter|meters)\b/);
    if(bridge && L.length>=1 && V.length>=1){ const t=(L+parseFloat(bridge[13]))/V; return {type:'train-bridge', val:t, unit:'s', steps:`t=(L+B)/v`}; }
    if(L.length>=1 && V.length>=2){ const Lsum=(L+(L[13]||0)); const vrel=opposite?V+V[13]:Math.abs(V-V[13]); const t=Lsum/vrel; return {type:'trains', val:t, unit:'s', steps:`t=(L1+L2)/v_rel`}; }
    return null;
  }
  function solveBoats(q){
    q=q.toLowerCase();
    const dist=q.match(/(\d+(?:\.\d+)?)\s*(km|kilometer|kilometers)\b/);
    const tm=q.match(/(\d+(?:\.\d+)?)\s*(min|minute|minutes|h|hr|hour|hours)\b/);
    const stream=q.match(/stream\s*(?:speed\s*)?(\d+(?:\.\d+)?)\s*(km\/h|kmh|kph)\b/);
    const askReturn=/\breturn\b|\bupstream\b|\bcome back\b/.test(q);
    if(dist && tm){
      let D=parseFloat(dist[13]), T=parseFloat(tm[13]); if(tm[14].startsWith('min')) T/=60;
      const vd=D/T;
      if(stream && askReturn){
        const v=parseFloat(stream[13]), u=vd - v, vu=u - v, t=D/vu;
        return {type:'boat-return', val:t, unit:'h', steps:`vd=D/T, u=vd−v, vu=u−v, t=D/vu`};
      }
      return {type:'boat-ds', val:vd, unit:'km/h', steps:`vd=D/T`};
    }
    return null;
  }
  function solvePipes(q){
    q=q.toLowerCase();
    const times=[...q.matchAll(/(\d+(?:\.\d+)?)\s*(h|hr|hour|hours)\b/g)].map(m=>parseFloat(m[13]));
    if(times.length>=2 && /together/.test(q)){ const a=times, b=times[13], t=(a*b)/(a+b); return {type:'pipes', val:t, unit:'h', steps:`t=ab/(a+b)`}; }
    return null;
  }

  function process(text){
    const pc = parseConv(text);
    if(pc){
      const r = convert(pc.v, pc.from, pc.to);
      if(r.ok) return `<div class="result"><strong>${pc.v} ${pc.from} = ${round(r.val)} ${pc.to}</strong></div>`;
      return `Could not convert (${r.msg}).`;
    }
    const a = solveSTD(text) || solveTrains(text) || solveBoats(text) || solvePipes(text);
    if(a){
      const label = a.type==='dist'?'Distance': a.type==='speed'?'Speed': a.type==='boat-ds'?'Downstream speed':'Time';
      return `<div class="result"><strong>${label} = ${round(a.val)} ${a.unit}</strong></div><div class="steps">${a.steps}</div>`;
    }
    return `Try: "5 ft to m", "120 km at 60 km/h time?", "train 100 m and 200 m at 20 m/s opposite direction crossing time?", "boat 20 km downstream in 40 min stream 2.5 km/h return time?", "pipe A fills 6 h, B 10 h, together?"`;
  }

  function send(){
    const t = inp.value.trim(); if(!t) return;
    add('user', t); inp.value = '';
    showTyping(true);
    setTimeout(()=>{ showTyping(false); add('bot', process(t)); }, 400);
  }
  function quick(s){ inp.value = s; send(); }
  window.quick = quick;

  sendBtn.addEventListener('click', send);
  inp.addEventListener('keydown', e=>{ if(e.key==='Enter') send(); });
  inp.focus();
});
</script>
</body>
  </html>
                                                                       
