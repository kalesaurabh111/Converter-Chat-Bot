<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Converter + Quants Chatbot</title>
<style>
  *{box-sizing:border-box}body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(135deg,#667eea,#764ba2);height:100vh;display:flex;align-items:center;justify-content:center;margin:0}
  .app{width:100%;max-width:900px;height:92vh;background:#fff;border-radius:20px;box-shadow:0 18px 40px rgba(0,0,0,.18);display:grid;grid-template-columns:360px 1fr;overflow:hidden}
  .side{background:#0f172a;color:#e2e8f0;padding:18px 16px;display:flex;flex-direction:column;gap:16px}
  .side h2{margin:0;color:#93c5fd;font-size:18px}
  .pill{background:#111827;border:1px solid #1f2937;border-radius:12px;padding:10px}
  .pill h3{margin:0 0 8px 0;font-size:14px;color:#f9fafb}
  .pill ul{margin:0;padding-left:18px}
  .pill li{font-size:13px;margin:6px 0}
  .container{display:flex;flex-direction:column}
  .header{background:linear-gradient(135deg,#16a34a,#22c55e);color:#fff;padding:16px 18px;display:flex;align-items:center;gap:10px}
  .dot{width:10px;height:10px;border-radius:50%;background:#86efac;box-shadow:0 0 0 6px rgba(134,239,172,.18)}
  .header h1{font-size:18px;margin:0}
  .messages{flex:1;overflow-y:auto;background:#f8fafc;padding:18px 18px 6px}
  .msg{display:flex;margin-bottom:12px}
  .msg.user{justify-content:flex-end}
  .bubble{max-width:78%;padding:12px 14px;border-radius:16px;font-size:14px;line-height:1.4;box-shadow:0 1px 0 rgba(0,0,0,.04)}
  .msg.user .bubble{background:#2563eb;color:#fff;border-bottom-right-radius:6px}
  .msg.bot .bubble{background:#fff;border:1px solid #e5e7eb;color:#0f172a;border-bottom-left-radius:6px}
  .result{background:#ecfdf5;border:1px solid #34d399;border-radius:10px;padding:10px;margin-top:8px}
  .steps{font-size:13px;color:#334155;margin-top:8px}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 12px}
  .chip{border:1px solid #e5e7eb;background:#fff;border-radius:999px;padding:6px 10px;font-size:12px;cursor:pointer}
  .chip:hover{background:#2563eb;color:#fff;border-color:#2563eb}
  .typing{display:none;margin:10px 0}
  .dots{display:flex;gap:5px}
  .dots span{width:8px;height:8px;border-radius:50%;background:#9ca3af;animation:blink 1.2s infinite}
  .dots span:nth-child(2){animation-delay:.2s}.dots span:nth-child(3){animation-delay:.4s}
  @keyframes blink{0%,60%,100%{opacity:.2}30%{opacity:1}}
  .input{display:flex;gap:10px;border-top:1px solid #e5e7eb;padding:12px;background:#fff}
  .input input{flex:1;border:1px solid #d1d5db;border-radius:999px;padding:12px 14px;font-size:14px;outline:none}
  .input input:focus{border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.1)}
  .input button{width:44px;height:44px;border-radius:50%;border:none;background:#2563eb;color:#fff;font-size:18px;cursor:pointer}
  .input button:hover{background:#1e40af}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, monospace;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:6px;padding:2px 6px;font-size:12px}
  @media (max-width:900px){.app{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="app">
  <aside class="side">
    <h2>Capabilities</h2>
    <div class="pill">
      <h3>Conversions</h3>
      <ul>
        <li>Length, Weight, Volume, Area</li>
        <li>Temperature (°C, °F, K)</li>
        <li>Time units</li>
      </ul>
    </div>
    <div class="pill">
      <h3>Quants Solver</h3>
      <ul>
        <li>Speed–Time–Distance</li>
        <li>Relative speed (trains)</li>
        <li>Boats & Streams</li>
        <li>Pipes & Cisterns</li>
      </ul>
    </div>
    <div class="pill">
      <h3>Examples</h3>
      <ul>
        <li><span class="kbd">5 ft to m</span></li>
        <li><span class="kbd">120 km at 60 km/h time?</span></li>
        <li><span class="kbd">Train 100m @ 20 m/s pass 200m?</span></li>
        <li><span class="kbd">Boat 20 km in 40 min, stream 2.5 km/h, return time?</span></li>
        <li><span class="kbd">Pipe A 6h, B 10h, together?</span></li>
      </ul>
    </div>
  </aside>

  <section class="container">
    <div class="header">
      <div class="dot"></div>
      <h1>AI Converter + Quants Assistant</h1>
    </div>
    <div class="messages" id="messages">
      <div class="msg bot">
        <div class="bubble">
          Welcome! This assistant converts units and solves common quants problems (speed–time–distance, trains, boats & streams, pipes & cisterns). Try: “25 miles to km”, “Distance = 60 km/h for 2 h?”, or “Two trains 100 m and 200 m at 20 m/s and 15 m/s opposite direction, crossing time?”.[web:7][web:27][web:33][web:35][web:34]
          <div class="chips">
            <button class="chip" onclick="quick('25 miles to km')">25 miles to km</button>
            <button class="chip" onclick="quick('120 km at 60 km/h time?')">120 km @ 60 km/h</button>
            <button class="chip" onclick="quick('train 100 m and 200 m at 20 m/s and 15 m/s opposite direction crossing time?')">Trains opposite</button>
            <button class="chip" onclick="quick('boat goes downstream 20 km in 40 min stream 2.5 km/h return time?')">Boat return</button>
            <button class="chip" onclick="quick('pipe A fills 6 h pipe B fills 10 h together time?')">Pipes together</button>
          </div>
        </div>
      </div>
      <div class="typing" id="typing"><div class="dots"><span></span><span></span><span></span></div></div>
    </div>
    <div class="input">
      <input id="input" placeholder="Ask a conversion or quants question..." />
      <button onclick="send()">➤</button>
    </div>
  </section>
</div>

<script>
/* ========= Unit Conversions =========
 Formulas and handling based on standard unit factors and temperature equations. [web:14][web:27][web:33]
*/
const conversions = {
  length: {
    meter:1,m:1,meters:1,metre:1,metres:1,
    kilometer:1000,km:1000,kilometers:1000,kilometre:1000,kilometres:1000,
    centimeter:0.01,cm:0.01,centimeterS:0.01,centimetre:0.01,centimetres:0.01,
    millimeter:0.001,mm:0.001,millimeters:0.001,
    inch:0.0254,inches:0.0254,in:0.0254,
    foot:0.3048,feet:0.3048,ft:0.3048,
    yard:0.9144,yards:0.9144,yd:0.9144,
    mile:1609.34,miles:1609.34,mi:1609.34
  },
  weight: {
    kilogram:1,kg:1,kilograms:1,
    gram:0.001,g:0.001,grams:0.001,
    pound:0.453592,pounds:0.453592,lb:0.453592,lbs:0.453592,
    ounce:0.0283495,ounces:0.0283495,oz:0.0283495,
    ton:1000,tons:1000,tonne:1000,tonnes:1000
  },
  volume: {
    liter:1,l:1,liters:1,litre:1,litres:1,
    milliliter:0.001,ml:0.001,milliliters:0.001,
    gallon:3.78541,gallons:3.78541,gal:3.78541, // US liquid
    quart:0.946353,quarts:0.946353,qt:0.946353,
    pint:0.473176,pints:0.473176,pt:0.473176,
    cup:0.236588,cups:0.236588,
    floz:0.0295735,"fluid ounce":0.0295735,"fluid ounces":0.0295735
  },
  temperature: { celsius:'c',c:'c',centigrade:'c',fahrenheit:'f',f:'f',kelvin:'k',k:'k' },
  area: {
    "square meter":1,"square meters":1,"m2":1,sqm:1,squaremeter:1,squaremeters:1,
    "square kilometer":1e6,"square kilometers":1e6,km2:1e6,sqkm:1e6,
    "square foot":0.092903,"square feet":0.092903,ft2:0.092903,sqft:0.092903,
    "square inch":0.00064516,"square inches":0.00064516,in2:0.00064516,sqin:0.00064516,
    acre:4046.86,acres:4046.86,hectare:10000,hectares:10000,ha:10000
  },
  time: {
    second:1,seconds:1,s:1,sec:1,
    minute:60,minutes:60,min:60,
    hour:3600,hourS:3600,h:3600,hr:3600,
    day:86400,days:86400,d:86400,
    week:604800,weeks:604800,wk:604800
  }
};

function tempConvert(val, from, to){
  // Convert via Celsius. [web:27][web:33]
  let C;
  if(from==='c') C = val;
  else if(from==='f') C = (val - 32)*5/9;
  else if(from==='k') C = val - 273.15;
  if(to==='c') return C;
  if(to==='f') return C*9/5 + 32;
  if(to==='k') return C + 273.15;
  return NaN;
}

function normalizeUnit(u){
  return u.toLowerCase().replace(/[^\w ]/g,'').trim().replace(/\s+/g,' ');
}

function findCategory(u){
  const key = normalizeUnit(u);
  for(const [cat, map] of Object.entries(conversions)){
    if(key in map) return {cat, key};
  }
  return null;
}

function convertUnits(value, fromUnit, toUnit){
  const from = findCategory(fromUnit);
  const to = findCategory(toUnit);
  if(!from || !to) return {ok:false, msg:"Unknown unit(s)."};
  if(from.cat !== to.cat) return {ok:false, msg:"Units must be in the same category."};
  if(from.cat==='temperature'){
    const res = tempConvert(value, conversions.temperature[from.key], conversions.temperature[to.key]);
    return {ok:true, value:res, cat:'temperature'};
  }
  const f = conversions[from.cat][from.key], t = conversions[to.cat][to.key];
  return {ok:true, value: value * f / t, cat:from.cat};
}

/* ========= Quants Solvers =========
 Core formulas for speed–time–distance, relative speed, boats & streams, pipes & cisterns. [web:27][web:33][web:30][web:35][web:34][web:31]
*/

// helpers
function toNumber(x){ return typeof x==='number'? x : parseFloat(String(x).replace(/,/g,'')); }
function round(x, p=5){ const f = Math.pow(10,p); return Math.round(x*f)/f; }
function ensureUnitsSpeed(dist, time, unitDist='km', unitTime='h'){
  // returns speed in unitDist/unitTime
  return dist / time;
}

// Speed–Time–Distance (S = D/T forms) [web:27][web:33]
function solveSTD(question){
  // heuristics: look for distance, speed, time with units
  // Supported: compute missing given two.
  // Extract numbers with possible units
  const q = question.toLowerCase();

  // Try patterns
  // 1) direct ask "time?" or "find time"
  const wantTime = /(\btime\b|\bhow long\b|\btime\?\b)/.test(q);
  const wantSpeed = /(\bspeed\b|\bvelocity\b|\bspeed\?\b)/.test(q);
  const wantDistance = /(\bdistance\b|\bdistance\?\b)/.test(q);

  // Extract distance value + unit
  const distMatch = q.match(/(\d+(?:\.\d+)?)\s*(km|kilometer|kilometers|m|meter|meters|mile|miles)\b/);
  // Extract time value + unit
  const timeMatch = q.match(/(\d+(?:\.\d+)?)\s*(h|hr|hour|hours|min|minute|minutes|s|sec|second|seconds)\b/);
  // Extract speed with unit
  const speedMatch = q.match(/(\d+(?:\.\d+)?)\s*(km\/h|kmh|kph|m\/s|mps|mph)\b/);

  function toKm(d, unit){
    if(!d) return null;
    if(unit.startsWith('km')) return d;
    if(unit==='mile' || unit==='miles') return d * 1.60934; // [web:33]
    if(unit==='m' || unit==='meter' || unit==='meters') return d/1000;
    return d;
  }
  function toHours(t, unit){
    if(!t) return null;
    if(unit==='h' || unit==='hr' || unit==='hour' || unit==='hours') return t;
    if(unit.startsWith('min')) return t/60;
    if(unit==='s' || unit==='sec' || unit==='second' || unit==='seconds') return t/3600;
    return t;
  }
  function speedToKmh(v, unit){
    if(!v) return null;
    if(unit==='km/h' || unit==='kmh' || unit==='kph') return v;
    if(unit==='m/s' || unit==='mps') return v * 3.6; // [web:33]
    if(unit==='mph') return v * 1.60934; // [web:33]
    return v;
  }

  const distVal = distMatch? toKm(toNumber(distMatch[1]), distMatch[2]) : null;
  const timeVal = timeMatch? toHours(toNumber(timeMatch[1]), timeMatch[2]) : null;
  const speedVal = speedMatch? speedToKmh(toNumber(speedMatch[1]), speedMatch[2]) : null;

  let steps = [];
  if(speedVal!=null && timeVal!=null && (wantDistance || (!wantSpeed && !wantTime))){
    const D = speedVal * timeVal;
    steps.push(`Using Distance = Speed × Time = ${round(speedVal)} km/h × ${round(timeVal)} h = ${round(D)} km.[web:27][web:33]`);
    return {type:'distance', value:D, unit:'km', steps};
  }
  if(distVal!=null && timeVal!=null && (wantSpeed || (!wantDistance && !wantTime))){
    const S = distVal / timeVal;
    steps.push(`Using Speed = Distance ÷ Time = ${round(distVal)} km ÷ ${round(timeVal)} h = ${round(S)} km/h.[web:27][web:33]`);
    return {type:'speed', value:S, unit:'km/h', steps};
  }
  if(distVal!=null && speedVal!=null && (wantTime || (!wantDistance && !wantSpeed))){
    const T = distVal / speedVal;
    steps.push(`Using Time = Distance ÷ Speed = ${round(distVal)} km ÷ ${round(speedVal)} km/h = ${round(T)} h.[web:27][web:33]`);
    return {type:'time', value:T, unit:'h', steps};
  }
  return null;
}

// Relative speed (trains/objects) [web:33][web:30]
function solveTrains(question){
  const q = question.toLowerCase();
  // Detect train lengths and speeds, direction
  const lens = [...q.matchAll(/(\d+(?:\.\d+)?)\s*(m|meter|meters)\b/g)].map(m=>({L:toNumber(m[1])}));
  const speeds = [...q.matchAll(/(\d+(?:\.\d+)?)\s*(m\/s|mps|km\/h|kmh|kph)\b/g)].map(m=>{
    let v = toNumber(m[1]);
    let unit = m[2];
    if(unit==='km/h' || unit==='kmh' || unit==='kph') v = v*1000/3600; // to m/s [web:33]
    return {v};
  });
  const opposite = /\b(opposite|opposite direction|towards)\b/.test(q);
  const same = /\b(same direction)\b/.test(q);

  if((lens.length>=1 || q.includes('bridge')) && speeds.length>=1){
    // crossing time cases
    // Case A: One train length L passes a point/bridge of length B at speed v: time = (L+B)/v
    const bridge = q.match(/(\d+(?:\.\d+)?)\s*(m|meter|meters)\s*(bridge)?/);
    if(bridge && lens.length===1 && speeds.length===1){
      const L = lens[0].L, B = toNumber(bridge[1]), v = speeds[0].v;
      const t = (L + B)/v;
      const steps = [
        `Crossing time over bridge: time = (train length + bridge length)/speed = (${L} + ${B})/`+
        `${round(v)} = ${round(t)} s.[web:33]`
      ];
      return {type:'train-bridge', value:t, unit:'s', steps};
    }
    // Case B: Two trains with lengths L1,L2 and speeds v1,v2
    if(lens.length>=1 && speeds.length>=2){
      const Lsum = lens.slice(0,2).reduce((a,b)=>a + b.L, 0);
      const v1 = speeds[0].v, v2 = speeds[1].v;
      const vrel = opposite? (v1+v2) : (same? Math.abs(v1 - v2) : (v1+v2));
      const t = Lsum / vrel;
      const steps = [
        `Relative speed = ${opposite? 'v1 + v2' : '│v1 − v2│'} = ${round(v1)} + ${round(opposite? v2 : -v2)} = ${round(vrel)} m/s.[web:33][web:30]`,
        `Crossing time = (sum of lengths)/relative speed = ${Lsum}/${round(vrel)} = ${round(t)} s.[web:33]`
      ];
      return {type:'trains-cross', value:t, unit:'s', steps};
    }
  }
  return null;
}

// Boats & Streams [web:35][web:30][web:33]
function solveBoats(question){
  const q = question.toLowerCase();
  // Parse downstream distance/time, stream speed, etc.
  const dist = q.match(/(\d+(?:\.\d+)?)\s*(km|kilometer|kilometers)\b/);
  const time = q.match(/(\d+(?:\.\d+)?)\s*(min|minute|minutes|h|hr|hour|hours)\b/);
  const stream = q.match(/stream\s*(?:speed\s*)?(\d+(?:\.\d+)?)\s*(km\/h|kmh|kph)\b/);
  const askReturn = /\breturn\b|\bcome back\b|\bupstream\b/.test(q);

  if(dist && time){
    let D = toNumber(dist[1]);
    let T = toNumber(time[1]);
    if(time[2].startsWith('min')) T = T/60; // to hours
    // downstream speed
    const vd = D / T;
    let steps = [`Downstream speed = distance/time = ${round(D)} / ${round(T)} = ${round(vd)} km/h.[web:33]`];
    if(stream){
      const vs = toNumber(stream[1]);
      const vu = vd - 2*vs + vs; // not yet, correct below
      // Formulas:
      // u = (vd + vu)/2, v = (vd - vu)/2 [web:35]
      // If only stream speed v known and downstream vd known, then upstream speed vu = vd - 2v +? No,
      // Actually vd = u + v, so given v, then u = vd - v, then vu = u - v = (vd - v) - v = vd - 2v.
      const v = vs;
      const u = vd - v;
      const vu2 = u - v; // upstream speed
      steps.push(`Let stream speed v = ${round(v)} km/h. Boat still-water speed u = vd − v = ${round(vd)} − ${round(v)} = ${round(u)} km/h.[web:35]`);
      steps.push(`Upstream speed = u − v = ${round(u)} − ${round(v)} = ${round(vu2)} km/h.[web:35]`);
      if(askReturn){
        const Tback = D / vu2;
        steps.push(`Return time upstream = distance / upstream speed = ${round(D)} / ${round(vu2)} = ${round(Tback)} h.[web:33][web:35]`);
        return {type:'boat-return', value:Tback, unit:'h', steps};
      } else {
        return {type:'boat-u-v', value:{u, v}, unit:'km/h', steps};
      }
    } else {
      return {type:'boat-downstream', value:vd, unit:'km/h', steps};
    }
  }
  // If explicitly given downstream and upstream speeds, compute u and v
  const vdMatch = q.match(/downstream\s*(?:speed\s*)?(\d+(?:\.\d+)?)\s*(km\/h|kmh|kph)\b/);
  const vuMatch = q.match(/upstream\s*(?:speed\s*)?(\d+(?:\.\d+)?)\s*(km\/h|kmh|kph)\b/);
  if(vdMatch && vuMatch){
    const vd = toNumber(vdMatch[1]), vu = toNumber(vuMatch[1]);
    const u = (vd + vu)/2, v = (vd - vu)/2; // [web:35]
    const steps = [
      `u = (vd + vu)/2 = (${vd} + ${vu})/2 = ${round(u)} km/h; v = (vd − vu)/2 = (${vd} − ${vu})/2 = ${round(v)} km/h.[web:35]`
    ];
    return {type:'boat-u-v', value:{u, v}, unit:'km/h', steps};
  }
  return null;
}

// Pipes & Cisterns [web:31][web:34]
function solvePipes(question){
  const q = question.toLowerCase();
  // patterns: "Pipe A fills 6 h, Pipe B 10 h, together time?"
  const times = [...q.matchAll(/(\d+(?:\.\d+)?)\s*(h|hr|hour|hours)\b/g)].map(m=>toNumber(m[1]));
  if(times.length>=2){
    const a = times[0], b = times[1];
    // Together time = ab/(a+b). [web:31]
    const together = (a*b)/(a+b);
    const steps = [
      `Rate of A = 1/${a} tank/h; Rate of B = 1/${b} tank/h.[web:31][web:34]`,
      `Combined rate = 1/${a} + 1/${b} = ${(a+b)/(a*b)} tank/h → time = 1/combined = (ab)/(a+b) = ${round(together)} h.[web:31]`
    ];
    return {type:'pipes-fill', value:together, unit:'h', steps};
  }
  // One fills (a), one empties (b) [web:31]
  const fill = q.match(/fills?\s*(\d+(?:\.\d+)?)\s*(h|hr|hour|hours)/);
  const empty = q.match(/empt(y|ies)\s*(\d+(?:\.\d+)?)\s*(h|hr|hour|hours)/);
  if(fill && empty){
    const a = toNumber(fill[1]), b = toNumber(empty[2]);
    const netRate = (1/a) - (1/b);
    const time = 1 / netRate;
    const steps = [
      `Fill rate = 1/${a} tank/h; Empty rate = 1/${b} tank/h.[web:31][web:34]`,
      `Net rate = 1/${a} − 1/${b} = ${(b-a)/(a*b)} tank/h → time = 1/net = ${round(time)} h (if b > a, tank may never fill). [web:31]`
    ];
    return {type:'pipes-net', value:time, unit:'h', steps};
  }
  return null;
}

/* ========= Input Parsing Dispatcher ========= */
function parseConversion(input){
  const patterns = [
    /(\d+(?:\.\d+)?)\s*([\w\s°\/]+?)\s*(?:to|into|in)\s*([\w\s°\/]+)/i,
    /convert\s*(\d+(?:\.\d+)?)\s*([\w\s°\/]+?)\s*(?:to|into|in)\s*([\w\s°\/]+)/i,
    /(\d+(?:\.\d+)?)\s*([\w\s°\/]+?)\s*=\s*\?\s*([\w\s°\/]+)/i
  ];
  for(const p of patterns){
    const m = input.match(p);
    if(m){
      return {value:parseFloat(m[1]), from:m[2].trim(), to:m[3].trim()};
    }
  }
  return null;
}

function process(input){
  // 1) Try unit conversion
  const conv = parseConversion(input);
  if(conv){
    const res = convertUnits(conv.value, conv.from, conv.to);
    if(res.ok){
      const val = round(res.value);
      return {
        html: `<div class="result"><strong>${conv.value} ${conv.from} = ${val} ${conv.to}</strong></div> Accurate per standard factors and temperature formulas.[web:14][web:27][web:33]`,
      };
    } else {
      return {html: `Could not convert: ${res.msg}[web:14]`};
    }
  }

  // 2) Try quants: STD
  const std = solveSTD(input);
  if(std){
    if(std.type==='distance'){
      return {
        html: `<div class="result"><strong>Distance = ${round(std.value)} km</strong></div><div class="steps">${std.steps.join('<br>')}</div>`
      };
    }
    if(std.type==='speed'){
      return {
        html: `<div class="result"><strong>Speed = ${round(std.value)} km/h</strong></div><div class="steps">${std.steps.join('<br>')}</div>`
      };
    }
    if(std.type==='time'){
      // Convert to hh:mm for readability
      const h = std.value, minutes = round(h*60,2);
      return {
        html: `<div class="result"><strong>Time = ${round(h)} h (${minutes} min)</strong></div><div class="steps">${std.steps.join('<br>')}</div>`
      };
    }
  }

  // 3) Trains (relative speed)
  const trains = solveTrains(input);
  if(trains){
    return {
      html: `<div class="result"><strong>Time = ${round(trains.value)} ${trains.unit}</strong></div><div class="steps">${trains.steps.join('<br>')}</div>`
    };
  }

  // 4) Boats & Streams
  const boats = solveBoats(input);
  if(boats){
    if(boats.type==='boat-return'){
      const minutes = round(boats.value*60,2);
      return {
        html: `<div class="result"><strong>Return time = ${round(boats.value)} h (${minutes} min)</strong></div><div class="steps">${boats.steps.join('<br>')}</div>`
      };
    }
    if(boats.type==='boat-u-v'){
      return {
        html: `<div class="result"><strong>Still-water speed u = ${round(boats.value.u)} km/h; Stream speed v = ${round(boats.value.v)} km/h</strong></div><div class="steps">${boats.steps.join('<br>')}</div>`
      };
    }
    if(boats.type==='boat-downstream'){
      return {
        html: `<div class="result"><strong>Downstream speed = ${round(boats.value)} km/h</strong></div><div class="steps">${boats.steps.join('<br>')}</div>`
      };
    }
  }

  // 5) Pipes & Cisterns
  const pipes = solvePipes(input);
  if(pipes){
    return {
      html: `<div class="result"><strong>Time = ${round(pipes.value)} ${pipes.unit}</strong></div><div class="steps">${pipes.steps.join('<br>')}</div>`
    };
  }

  // Default help
  return {
    html: `Sorry, could not parse that. Try:<br>
    • "5 feet to meters"<br>
    • "120 km at 60 km/h time?"<br>
    • "Train 100 m and 200 m at 20 m/s and 15 m/s opposite direction crossing time?"<br>
    • "Boat goes downstream 20 km in 40 min, stream 2.5 km/h, return time?"<br>
    • "Pipe A fills 6 h, B fills 10 h, together time?"[web:7][web:27][web:33][web:35][web:31]`
  };
}

/* ========= Chat UI ========= */
function addMsg(text, who='bot'){
  const m = document.getElementById('messages');
  const wrap = document.createElement('div');
  wrap.className = `msg ${who}`;
  const bubble = document.createElement('div');
  bubble.className = 'bubble';
  bubble.innerHTML = text;
  wrap.appendChild(bubble);
  m.appendChild(wrap);
  m.scrollTop = m.scrollHeight;
}

function showTyping(state){
  const t = document.getElementById('typing');
  t.style.display = state? 'block':'none';
  const m = document.getElementById('messages'); m.scrollTop = m.scrollHeight;
}

function send(){
  const inp = document.getElementById('input');
  const val = inp.value.trim();
  if(!val) return;
  addMsg(val, 'user');
  inp.value = '';
  showTyping(true);
  setTimeout(()=>{
    const out = process(val);
    showTyping(false);
    addMsg(out.html, 'bot');
  }, 700);
}

function quick(s){
  const inp = document.getElementById('input');
  inp.value = s;
  send();
}

document.getElementById('input').addEventListener('keydown', e=>{
  if(e.key==='Enter') send();
});
</script>
</body>
</html>
